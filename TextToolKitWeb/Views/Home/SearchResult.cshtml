@*
    Result of search will go here
*@
@model SearchModel
<p style="font-size:x-small;color:red">
    <u>Note:</u><br />
    * Letter casing is ignored in search. All will be counted as lower case.<br />
    * To start a completely new search, select the Search module at the top.
</p>
<br />

<h6><b>Text Entry:</b></h6>

<table class="table table-bordered">
    <tr>
        @if (ViewBag.SearchIndices.Count > 0)
        {
            <td id="result"></td>
        }
        else
        {
            <td>@ViewBag.UserTextEntry</td>
        }
    </tr>
</table>
<br />

<table class="table table-bordered">
    <tr>
        <td style="width:25%">Search Item</td>
        <td>@ViewBag.UserSearchItem</td>
    </tr>
    <tr>
        <td style="width:25%">Number of Occurences</td>
        <td>@ViewBag.SearchIndices.Count</td>
    </tr>
</table>
<br />
<br />

@using (Html.BeginForm("SearchNewItem", "Home", FormMethod.Post))
{
    <table cellpadding="0" cellspacing="0">
        <tr>
            <td hidden>
                @Html.TextAreaFor(m => m.UserTextEntry, new { style = "width:600px;", Value = "@ViewBag.UserTextEntry" })
        </td>
    </tr>
    <tr>
        <td><input style="width:275px;text-align:center;" type="submit" value="Search Same Text for New Item" /></td>
    </tr>
</table>
}

@using (Html.BeginForm("SearchEntry", "Home", FormMethod.Get))
{
    <table cellpadding="0" cellspacing="0">
    <tr>
        <td><input style="width:275px;text-align:center;" type="submit" value="Start Completely New Search" /></td>
    </tr>
</table>
}


<style>
    .highlight {
        background-color: yellow;
    }
</style>

<script>
    var userText = '@ViewBag.UserTextEntry';
    var indices = @Json.Serialize(ViewBag.SearchIndices)
    var count = @ViewBag.UserSearchItem.Length;

    let result = indices.reduce((str, start) => {
    str[start] = `<span class="highlight">${str[start]}`;
    str[start + count - 1] = `${str[start + count - 1]}</span>`;
    return str;
    },  userText.split("")).join("");

    document.getElementById("result").innerHTML = result;
</script>
